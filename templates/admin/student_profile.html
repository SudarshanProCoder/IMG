{% extends "admin/base.html" %}

{% block title %}Student Profile - {{ student.name|default('Student') }}{% endblock %}

{% block extra_css %}
<style>
    /* CSS Variables for glassy theme */
    :root {
        --gradient-primary: #8a2be2;
        --gradient-secondary: #4b0082;
        --card-bg: rgba(255, 255, 255, 0.1);
        --card-border: rgba(255, 255, 255, 0.2);
        --text-primary: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.8);
        --accent-color: #8a2be2;
        --input-bg: rgba(255, 255, 255, 0.1);
        --input-border: rgba(255, 255, 255, 0.3);
        --input-text: #ffffff;
    }

    .profile-header {
        background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-secondary));
        color: white;
        padding: 2rem 1rem;
        margin: -1.5rem -1.5rem 2rem -1.5rem;
        border-radius: 0;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @media (min-width: 768px) {
        .profile-header {
            padding: 3rem 2rem;
            margin: -1.5rem -1.5rem 2rem -1.5rem;
            border-radius: 0 0 1rem 1rem;
        }
    }

    .profile-avatar {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        border: 4px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        margin-bottom: 1rem;
        object-fit: cover;
        background-color: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
    }

    .profile-info {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        color: var(--text-primary);
        transition: all 0.3s ease;
    }

    .profile-info:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .info-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        transition: all 0.3s ease;
        margin-bottom: 1rem;
    }

    .info-item:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
    }

    .info-item i {
        color: var(--accent-color);
        font-size: 1.1rem;
        margin-top: 0.2rem;
        min-width: 20px;
    }

    .info-item div {
        flex: 1;
    }

    .info-label {
        color: var(--text-secondary);
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
        font-weight: 500;
    }

    .info-value {
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 0;
        font-size: 1rem;
    }

    /* Grid Layout for Activities and Internships */
    .activities-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .activity-card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        padding: 1.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        color: var(--text-primary);
        height: fit-content;
    }

    .activity-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .activity-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .activity-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
        font-size: 1.1rem;
        color: var(--text-primary);
        line-height: 1.3;
    }

    .activity-meta {
        color: var(--text-secondary);
        font-size: 0.875rem;
        line-height: 1.4;
    }

    .activity-status {
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        backdrop-filter: blur(10px);
        white-space: nowrap;
    }

    .status-pending {
        background: rgba(255, 193, 7, 0.2);
        color: #ffc107;
        border: 1px solid rgba(255, 193, 7, 0.3);
    }

    .status-approved {
        background: rgba(40, 167, 69, 0.2);
        color: #28a745;
        border: 1px solid rgba(40, 167, 69, 0.3);
    }

    .status-rejected {
        background: rgba(220, 53, 69, 0.2);
        color: #dc3545;
        border: 1px solid rgba(220, 53, 69, 0.3);
    }

    .activity-details {
        margin-bottom: 1.5rem;
        color: var(--text-secondary);
    }

    .activity-details p {
        margin-bottom: 0.5rem;
        line-height: 1.4;
    }

    .btn-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .btn-group .btn {
        flex: 1;
        min-width: 100px;
        white-space: nowrap;
        border-radius: 12px;
        transition: all 0.3s ease;
        font-size: 0.875rem;
        padding: 0.5rem 0.75rem;
    }

    .btn-group .btn:hover {
        transform: translateY(-2px);
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-secondary));
        border: none;
        box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
    }

    .btn-success {
        background: linear-gradient(135deg, #28a745, #20c997);
        border: none;
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    .btn-danger {
        background: linear-gradient(135deg, #dc3545, #c82333);
        border: none;
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
    }

    .btn-warning {
        background: linear-gradient(135deg, #ffc107, #fd7e14);
        border: none;
        box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
    }

    .btn-info {
        background: linear-gradient(135deg, #17a2b8, #138496);
        border: none;
        box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
    }

    @media (max-width: 767px) {
        .container {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .row {
            margin-left: -0.5rem;
            margin-right: -0.5rem;
        }

        .col-md-6 {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }

        .profile-info {
            padding: 1rem;
        }

        .activity-card {
            padding: 1rem;
        }

        .btn-group .btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }

        .activities-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
    }

    /* Animation classes */
    .animate-fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    .animate-slide-up {
        animation: slideUp 0.5s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes slideUp {
        from {
            transform: translateY(20px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .detail-btn {
        cursor: pointer;
        color: var(--accent-color);
        text-decoration: underline;
        transition: all 0.3s ease;
    }

    .detail-btn:hover {
        color: var(--gradient-secondary);
        transform: translateY(-1px);
    }

    .modal-dialog {
        max-width: 900px;
    }

    .modal-body {
        max-height: 70vh;
        overflow-y: auto;
        padding: 1.5rem;
    }

    .detail-item {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .detail-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .detail-label {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        text-transform: uppercase;
    }

    .detail-value {
        color: var(--text-secondary);
        font-size: 1rem;
        line-height: 1.5;
    }

    .skills-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .skill-badge {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.875rem;
        display: inline-block;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .certificate-preview {
        max-width: 100%;
        height: auto;
        border: 1px solid var(--card-border);
        border-radius: 0.25rem;
        margin-top: 0.5rem;
    }

    .certificate-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--accent-color);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .certificate-link:hover {
        color: var(--gradient-secondary);
        text-decoration: underline;
        transform: translateY(-1px);
    }

    .certificate-link i {
        font-size: 1.25rem;
    }

    .pdf-container {
        position: relative;
        min-height: 400px;
        background: var(--card-bg);
        padding: 1rem;
        border-radius: 0.25rem;
        backdrop-filter: blur(10px);
        border: 1px solid var(--card-border);
    }

    .pdf-viewer {
        position: relative;
        width: 100%;
        height: 400px;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 0.25rem;
        overflow: hidden;
        backdrop-filter: blur(10px);
    }

    .pdf-viewer iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    .preview-container {
        background: var(--card-bg);
        padding: 1rem;
        border-radius: 0.25rem;
        text-align: center;
        border: 1px solid var(--card-border);
        backdrop-filter: blur(10px);
    }

    .preview-container img {
        max-height: 300px;
        width: auto;
        margin: 0 auto;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        border-radius: 12px;
    }

    .pdf-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        background: var(--card-bg);
        padding: 1rem;
        border-radius: 0.25rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid var(--card-border);
        color: var(--text-primary);
    }

    .image-container {
        background: var(--card-bg);
        padding: 1rem;
        border-radius: 0.25rem;
        text-align: center;
        backdrop-filter: blur(10px);
        border: 1px solid var(--card-border);
    }

    .image-container img {
        max-width: 100%;
        height: auto;
        max-height: 500px;
        object-fit: contain;
        border: 1px solid var(--card-border);
        border-radius: 0.25rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .image-container .btn {
        margin: 0 0.25rem;
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .image-container .btn:hover {
        transform: translateY(-2px);
    }

    /* Statistics Cards */
    .stats-card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        color: var(--text-primary);
        transition: all 0.3s ease;
    }

    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .stats-card .card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        backdrop-filter: blur(10px);
    }

    .stats-card .card-body {
        color: var(--text-primary);
        text-align: center;
    }

    .stats-card h6 {
        color: var(--text-secondary);
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .stats-card h3 {
        color: var(--accent-color);
        font-weight: 700;
        margin-bottom: 0.25rem;
        background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stats-card small {
        color: var(--text-secondary);
        font-size: 0.8rem;
    }

    /* Section Headers */
    .section-header {
        background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-secondary));
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .section-header h5 {
        margin: 0;
        font-weight: 600;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .profile-header {
            padding: 1.5rem 1rem;
            margin: -1rem -1rem 1.5rem -1rem;
        }

        .profile-info,
        .activity-card,
        .stats-card {
            margin-bottom: 1rem;
            padding: 1rem;
        }

        .btn-group .btn {
            min-width: 100px;
            font-size: 0.8rem;
        }

        .activities-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .container-fluid {
            padding-left: 1rem;
            padding-right: 1rem;
        }
    }

    /* Ensure modal content is properly visible */
    .modal-content {
        color: var(--text-primary);
    }

    .modal-body {
        color: var(--text-primary);
    }

    .detail-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 1rem;
    }

    .detail-label {
        color: var(--accent-color);
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .detail-value {
        color: var(--text-primary);
        line-height: 1.6;
    }

    /* Fix for grid layout on smaller screens */
    @media (max-width: 1200px) {
        .activities-grid {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
    }

    @media (max-width: 992px) {
        .activities-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Student Information -->
        <div class="col-md-4">
            <div class="profile-info">
                <div class="text-center mb-3">
                    <img src="{{ student.profile_image|default(url_for('static', filename='images/default_avatar.png')) }}"
                        alt="Profile Image" class="profile-avatar">
                </div>
                <h4 class="text-center mb-3">{{ student.name|default('N/A') }}</h4>
                <div class="info-item">
                    <i class="fas fa-id-card"></i>
                    <div>
                        <div class="info-label">Student ID</div>
                        <div class="info-value">{{ student._id|default('N/A') }}</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-envelope"></i>
                    <div>
                        <div class="info-label">Email</div>
                        <div class="info-value">{{ student.email|default('N/A') }}</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-graduation-cap"></i>
                    <div>
                        <div class="info-label">Branch</div>
                        <div class="info-value">{{ student.branch|default('N/A') }}</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-calendar"></i>
                    <div>
                        <div class="info-label">Year</div>
                        <div class="info-value">{{ student.year|default('N/A') }}</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-hashtag"></i>
                    <div>
                        <div class="info-label">Roll Number</div>
                        <div class="info-value">{{ student.roll_number|default('N/A') }}</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-phone"></i>
                    <div>
                        <div class="info-label">Phone</div>
                        <div class="info-value">{{ student.phone|default('N/A') }}</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-venus-mars"></i>
                    <div>
                        <div class="info-label">Gender</div>
                        <div class="info-value">{{ student.gender|default('N/A') }}</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-birthday-cake"></i>
                    <div>
                        <div class="info-label">Date of Birth</div>
                        <div class="info-value">{{ student.date_of_birth|default('N/A') }}</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <div>
                        <div class="info-label">Address</div>
                        <div class="info-value">{{ student.address|default('N/A') }}</div>
                    </div>
                </div>
            </div>

            <!-- Statistics Card -->
            <div class="stats-card">
                <div class="section-header">
                    <h5><i class="fas fa-chart-bar me-2"></i>Statistics</h5>
                </div>
                <div class="row">
                    <div class="col-6 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <h6>Total Internships</h6>
                                <h3>{{ internship_count|default(0) }}</h3>
                                <small>Approved: {{ approved_internships|default(0) }}</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <h6>Total Activities</h6>
                                <h3>{{ activity_count|default(0) }}</h3>
                                <small>Approved: {{ approved_activities|default(0) }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <!-- Internships Section -->
            <div class="section-header">
                <h5><i class="fas fa-briefcase me-2"></i>Internships</h5>
            </div>

            {% if internships %}
            <div class="activities-grid">
                {% for internship in internships %}
                <div class="activity-card" data-internship-id="{{ internship._id }}"
                    data-company-name="{{ internship.company_name|default('N/A') }}"
                    data-project-name="{{ internship.project_name|default('N/A') }}"
                    data-position="{{ internship.position|default('N/A') }}"
                    data-description="{{ internship.description|default('N/A') }}"
                    data-start-date="{{ internship.start_date|default('N/A') }}"
                    data-end-date="{{ internship.end_date|default('N/A') }}"
                    data-duration-months="{{ internship.duration_months|default('N/A') }}"
                    data-semester="{{ internship.semester|default('N/A') }}"
                    data-hours-per-week="{{ internship.hours_per_week|default('N/A') }}"
                    data-total-hours="{{ internship.total_hours|default('N/A') }}"
                    data-academic-year="{{ internship.academic_year|default('N/A') }}"
                    data-offer-letter-url="{{ internship.offer_letter_url|default('') }}"
                    data-completion-letter-url="{{ internship.completion_letter_url|default('') }}"
                    data-skills="{{ internship.skills|default([])|join(',') }}"
                    data-status="{{ internship.status|default('pending') }}"
                    data-created-at="{{ internship.created_at|default('') }}"
                    data-updated-at="{{ internship.updated_at|default('') }}">
                    <div class="activity-header">
                        <div>
                            <div class="activity-title">{{ internship.company_name|default('N/A') }}</div>
                            <div class="activity-meta">
                                <i class="fas fa-calendar me-1"></i>{{ internship.start_date|default('N/A') }} - {{
                                internship.end_date|default('N/A') }}
                                <br>
                                <i class="fas fa-map-marker-alt me-1"></i>{{ internship.location|default('N/A') }}
                            </div>
                        </div>
                        <span class="activity-status status-{{ internship.status|default('pending') }}">
                            {{ internship.status|default('Pending')|title }}
                        </span>
                    </div>
                    <div class="activity-details">
                        <p><strong>Position:</strong> {{ internship.position|default('N/A') }}</p>
                        <p><strong>Description:</strong> {{ internship.description|default('N/A')|truncate(100) }}</p>
                        {% if internship.skills %}
                        <p><strong>Skills:</strong></p>
                        <div class="skills-list">
                            {% for skill in internship.skills[:3] %}
                            <span class="skill-badge">{{ skill }}</span>
                            {% endfor %}
                            {% if internship.skills|length > 3 %}
                            <span class="skill-badge">+{{ internship.skills|length - 3 }} more</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-info btn-sm"
                            onclick="viewInternshipDetails('{{ internship._id }}')">
                            <i class="fas fa-eye me-1"></i>View Details
                        </button>
                        {% if internship.status == 'pending' %}
                        <a href="{{ url_for('admin.approve_internship', internship_id=internship._id) }}"
                            class="btn btn-success btn-sm"
                            onclick="return confirm('Are you sure you want to approve this internship?')">
                            <i class="fas fa-check me-1"></i>Approve
                        </a>
                        <a href="{{ url_for('admin.reject_internship', internship_id=internship._id) }}"
                            class="btn btn-danger btn-sm"
                            onclick="return confirm('Are you sure you want to reject this internship?')">
                            <i class="fas fa-times me-1"></i>Reject
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="activity-card text-center">
                <i class="fas fa-briefcase fa-3x mb-3" style="color: var(--text-secondary);"></i>
                <h5>No Internships Found</h5>
                <p class="text-muted">This student hasn't submitted any internship applications yet.</p>
            </div>
            {% endif %}

            <!-- Activities Section -->
            <div class="section-header mt-4">
                <h5><i class="fas fa-tasks me-2"></i>Activities</h5>
            </div>

            {% if activities %}
            <div class="activities-grid">
                {% for activity in activities %}
                <div class="activity-card" data-activity-id="{{ activity._id }}"
                    data-title="{{ activity.title|default('N/A') }}"
                    data-activity-type="{{ activity.activity_type|default('N/A') }}"
                    data-description="{{ activity.description|default('N/A') }}"
                    data-category="{{ activity.category|default('N/A') }}"
                    data-start-date="{{ activity.start_date|default('N/A') }}"
                    data-end-date="{{ activity.end_date|default('N/A') }}"
                    data-duration-months="{{ activity.duration_months|default('N/A') }}"
                    data-semester="{{ activity.semester|default('N/A') }}"
                    data-hours-per-week="{{ activity.hours_per_week|default('N/A') }}"
                    data-total-hours="{{ activity.total_hours|default('N/A') }}"
                    data-academic-year="{{ activity.academic_year|default('N/A') }}"
                    data-certificate-path="{{ activity.certificate_path|default('') }}"
                    data-skills="{{ activity.skills|default([])|join(',') }}"
                    data-status="{{ activity.status|default('pending') }}"
                    data-created-at="{{ activity.created_at|default('') }}"
                    data-updated-at="{{ activity.updated_at|default('') }}">
                    <div class="activity-header">
                        <div>
                            <div class="activity-title">{{ activity.title|default('N/A') }}</div>
                            <div class="activity-meta">
                                <i class="fas fa-calendar me-1"></i>{{ activity.date|default('N/A') }}
                                <br>
                                <i class="fas fa-clock me-1"></i>{{ activity.duration|default('N/A') }} hours
                            </div>
                        </div>
                        <span class="activity-status status-{{ activity.status|default('pending') }}">
                            {{ activity.status|default('Pending')|title }}
                        </span>
                    </div>
                    <div class="activity-details">
                        <p><strong>Description:</strong> {{ activity.description|default('N/A')|truncate(100) }}</p>
                        <p><strong>Category:</strong> {{ activity.category|default('N/A') }}</p>
                        {% if activity.skills %}
                        <p><strong>Skills:</strong></p>
                        <div class="skills-list">
                            {% for skill in activity.skills[:3] %}
                            <span class="skill-badge">{{ skill }}</span>
                            {% endfor %}
                            {% if activity.skills|length > 3 %}
                            <span class="skill-badge">+{{ activity.skills|length - 3 }} more</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-info btn-sm"
                            onclick="viewActivityDetails('{{ activity._id }}')">
                            <i class="fas fa-eye me-1"></i>View Details
                        </button>
                        {% if activity.status == 'pending' %}
                        <a href="{{ url_for('admin.approve_activity', activity_id=activity._id) }}"
                            class="btn btn-success btn-sm"
                            onclick="return confirm('Are you sure you want to approve this activity?')">
                            <i class="fas fa-check me-1"></i>Approve
                        </a>
                        <a href="{{ url_for('admin.reject_activity', activity_id=activity._id) }}"
                            class="btn btn-danger btn-sm"
                            onclick="return confirm('Are you sure you want to reject this activity?')">
                            <i class="fas fa-times me-1"></i>Reject
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="activity-card text-center">
                <i class="fas fa-tasks fa-3x mb-3" style="color: var(--text-secondary);"></i>
                <h5>No Activities Found</h5>
                <p class="text-muted">This student hasn't submitted any activities yet.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Internship Details Modal -->
<div class="modal fade" id="internshipModal" tabindex="-1" aria-labelledby="internshipModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content"
            style="background: var(--card-bg); backdrop-filter: blur(20px); border: 1px solid var(--card-border);">
            <div class="modal-header"
                style="background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-secondary)); color: white; border-bottom: 1px solid var(--card-border);">
                <h5 class="modal-title" id="internshipModalLabel">Internship Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body" id="internshipModalBody">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Activity Details Modal -->
<div class="modal fade" id="activityModal" tabindex="-1" aria-labelledby="activityModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content"
            style="background: var(--card-bg); backdrop-filter: blur(20px); border: 1px solid var(--card-border);">
            <div class="modal-header"
                style="background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-secondary)); color: white; border-bottom: 1px solid var(--card-border);">
                <h5 class="modal-title" id="activityModalLabel">Activity Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body" id="activityModalBody">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<script>
    // Add intersection observer for animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe all cards
    document.addEventListener('DOMContentLoaded', () => {
        const cards = document.querySelectorAll('.profile-info, .activity-card, .stats-card');
        cards.forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            observer.observe(card);
        });
    });

    // Helper function to find element by text content
    function findElementByText(parent, searchText) {
        const elements = parent.querySelectorAll('p');
        for (let element of elements) {
            if (element.textContent.includes(searchText)) {
                return element;
            }
        }
        return null;
    }

    // Function to view internship details in modal
    function viewInternshipDetails(internshipId) {
        console.log('Opening internship modal for ID:', internshipId);

        try {
            const modal = new bootstrap.Modal(document.getElementById('internshipModal'));
            const modalBody = document.getElementById('internshipModalBody');

            if (!modal || !modalBody) {
                console.error('Modal elements not found');
                alert('Error: Modal not found. Please refresh the page.');
                return;
            }

            modalBody.innerHTML = '<div class="pdf-loading">Loading Internship Details...</div>';

            // Find the internship card and extract all data from data attributes
            const internshipCard = document.querySelector(`[data-internship-id="${internshipId}"]`);

            if (!internshipCard) {
                console.error('Internship card not found');
                modalBody.innerHTML = '<div class="alert alert-danger">Error: Could not find internship details.</div>';
                modal.show();
                return;
            }

            // Extract all data from data attributes
            const companyName = internshipCard.dataset.companyName || 'N/A';
            const projectName = internshipCard.dataset.projectName || 'N/A';
            const position = internshipCard.dataset.position || 'N/A';
            const description = internshipCard.dataset.description || 'N/A';
            const startDate = internshipCard.dataset.startDate || 'N/A';
            const endDate = internshipCard.dataset.endDate || 'N/A';
            const durationMonths = internshipCard.dataset.durationMonths || 'N/A';
            const semester = internshipCard.dataset.semester || 'N/A';
            const hoursPerWeek = internshipCard.dataset.hoursPerWeek || 'N/A';
            const totalHours = internshipCard.dataset.totalHours || 'N/A';
            const academicYear = internshipCard.dataset.academicYear || 'N/A';
            const offerLetterUrl = internshipCard.dataset.offerLetterUrl || '';
            const completionLetterUrl = internshipCard.dataset.completionLetterUrl || '';
            const skills = internshipCard.dataset.skills ? internshipCard.dataset.skills.split(',').filter(s => s && s !== 'N/A') : [];
            const status = internshipCard.dataset.status || 'pending';
            const createdAt = internshipCard.dataset.createdAt || '';
            const updatedAt = internshipCard.dataset.updatedAt || '';

            console.log('Extracted data:', { companyName, projectName, position, description, status, skills });

            // Display comprehensive details in the modal
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-item">
                            <div class="detail-label">Company Name</div>
                            <div class="detail-value">${companyName}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Position</div>
                            <div class="detail-value">${position}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status</div>
                            <div class="detail-value">
                                <span class="badge ${status === 'approved' ? 'bg-success' : status === 'rejected' ? 'bg-danger' : 'bg-warning'}">
                                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                                </span>
                            </div>
                        </div>
                        ${projectName !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Project Name</div>
                            <div class="detail-value">${projectName}</div>
                        </div>
                        ` : ''}
                        ${semester !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Semester</div>
                            <div class="detail-value">${semester}</div>
                        </div>
                        ` : ''}
                        ${academicYear !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Academic Year</div>
                            <div class="detail-value">${academicYear}</div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="col-md-6">
                        <div class="detail-item">
                            <div class="detail-label">Description</div>
                            <div class="detail-value">${description}</div>
                        </div>
                        ${hoursPerWeek !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Hours per Week</div>
                            <div class="detail-value">${hoursPerWeek} hours</div>
                        </div>
                        ` : ''}
                        ${totalHours !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Total Hours</div>
                            <div class="detail-value">${totalHours} hours</div>
                        </div>
                        ` : ''}
                        ${durationMonths !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Duration</div>
                            <div class="detail-value">${durationMonths} months</div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                ${startDate !== 'N/A' || endDate !== 'N/A' ? `
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="detail-item">
                            <div class="detail-label">Timeline</div>
                            <div class="detail-value">
                                <strong>Start Date:</strong> ${startDate}<br>
                                <strong>End Date:</strong> ${endDate}
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                ${skills.length > 0 ? `
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="detail-item">
                            <div class="detail-label">Skills & Technologies</div>
                            <div class="detail-value">
                                <div class="skills-list">
                                    ${skills.map(skill => `<span class="skill-badge">${skill}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                ${offerLetterUrl || completionLetterUrl ? `
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="detail-item">
                            <div class="detail-label">Documents</div>
                            <div class="detail-value">
                                ${offerLetterUrl ? `
                                <div class="mb-2">
                                    <strong>Offer Letter:</strong> 
                                    <a href="${offerLetterUrl}" target="_blank" class="certificate-link">
                                        <i class="fas fa-file-pdf"></i> View Offer Letter
                                    </a>
                                </div>
                                ` : ''}
                                ${completionLetterUrl ? `
                                <div class="mb-2">
                                    <strong>Completion Letter:</strong> 
                                    <a href="${completionLetterUrl}" target="_blank" class="certificate-link">
                                        <i class="fas fa-file-pdf"></i> View Completion Letter
                                    </a>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="detail-item">
                            <div class="detail-label">Full Details</div>
                            <div class="detail-value">
                                <p>This internship application was submitted by the student and is currently in <strong>${status}</strong> status.</p>
                                <p>For complete information including all documents, certificates, and detailed records, please check the student's full profile in the database.</p>
                                ${createdAt ? `
                                <p><strong>Submitted on:</strong> ${new Date(createdAt).toLocaleDateString()}</p>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            modal.show();
            console.log('Modal opened successfully');

        } catch (error) {
            console.error('Error opening internship modal:', error);
            alert('Error opening modal. Please check the console for details.');
        }
    }

    // Function to view activity details in modal
    function viewActivityDetails(activityId) {
        console.log('Opening activity modal for ID:', activityId);

        try {
            const modal = new bootstrap.Modal(document.getElementById('activityModal'));
            const modalBody = document.getElementById('activityModalBody');

            if (!modal || !modalBody) {
                console.error('Modal elements not found');
                alert('Error: Modal not found. Please refresh the page.');
                return;
            }

            modalBody.innerHTML = '<div class="pdf-loading">Loading Activity Details...</div>';

            // Find the activity card and extract all data from data attributes
            const activityCard = document.querySelector(`[data-activity-id="${activityId}"]`);

            if (!activityCard) {
                console.error('Activity card not found');
                modalBody.innerHTML = '<div class="alert alert-danger">Error: Could not find activity details.</div>';
                modal.show();
                return;
            }

            // Extract all data from data attributes
            const title = activityCard.dataset.title || 'N/A';
            const activityType = activityCard.dataset.activityType || 'N/A';
            const description = activityCard.dataset.description || 'N/A';
            const category = activityCard.dataset.category || 'N/A';
            const startDate = activityCard.dataset.startDate || 'N/A';
            const endDate = activityCard.dataset.endDate || 'N/A';
            const durationMonths = activityCard.dataset.durationMonths || 'N/A';
            const semester = activityCard.dataset.semester || 'N/A';
            const hoursPerWeek = activityCard.dataset.hoursPerWeek || 'N/A';
            const totalHours = activityCard.dataset.totalHours || 'N/A';
            const academicYear = activityCard.dataset.academicYear || 'N/A';
            const certificatePath = activityCard.dataset.certificatePath || '';
            const skills = activityCard.dataset.skills ? activityCard.dataset.skills.split(',').filter(s => s && s !== 'N/A') : [];
            const status = activityCard.dataset.status || 'pending';
            const createdAt = activityCard.dataset.createdAt || '';
            const updatedAt = activityCard.dataset.updatedAt || '';

            console.log('Extracted data:', { title, activityType, description, category, status, skills });

            // Display comprehensive details in the modal
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="detail-item">
                            <div class="detail-label">Title</div>
                            <div class="detail-value">${title}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Category</div>
                            <div class="detail-value">${category}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status</div>
                            <div class="detail-value">
                                <span class="badge ${status === 'approved' ? 'bg-success' : status === 'rejected' ? 'bg-danger' : 'bg-warning'}">
                                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                                </span>
                            </div>
                        </div>
                        ${activityType !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Activity Type</div>
                            <div class="detail-value">${activityType}</div>
                        </div>
                        ` : ''}
                        ${semester !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Semester</div>
                            <div class="detail-value">${semester}</div>
                        </div>
                        ` : ''}
                        ${academicYear !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Academic Year</div>
                            <div class="detail-value">${academicYear}</div>
                        </div>
                        ` : ''}
                    </div>
                    <div class="col-md-6">
                        <div class="detail-item">
                            <div class="detail-label">Description</div>
                            <div class="detail-value">${description}</div>
                        </div>
                        ${hoursPerWeek !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Hours per Week</div>
                            <div class="detail-value">${hoursPerWeek} hours</div>
                        </div>
                        ` : ''}
                        ${totalHours !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Total Hours</div>
                            <div class="detail-value">${totalHours} hours</div>
                        </div>
                        ` : ''}
                        ${durationMonths !== 'N/A' ? `
                        <div class="detail-item">
                            <div class="detail-label">Duration</div>
                            <div class="detail-value">${durationMonths} months</div>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                ${startDate !== 'N/A' || endDate !== 'N/A' ? `
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="detail-item">
                            <div class="detail-label">Timeline</div>
                            <div class="detail-value">
                                <strong>Start Date:</strong> ${startDate}<br>
                                <strong>End Date:</strong> ${endDate}
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                ${skills.length > 0 ? `
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="detail-item">
                            <div class="detail-label">Skills & Technologies</div>
                            <div class="detail-value">
                                <div class="skills-list">
                                    ${skills.map(skill => `<span class="skill-badge">${skill}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                ${certificatePath ? `
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="detail-item">
                            <div class="detail-label">Certificate</div>
                            <div class="detail-value">
                                <a href="${certificatePath}" target="_blank" class="certificate-link">
                                    <i class="fas fa-certificate"></i> View Certificate
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="detail-item">
                            <div class="detail-label">Full Details</div>
                            <div class="detail-value">
                                <p>This activity was submitted by the student and is currently in <strong>${status}</strong> status.</p>
                                <p>For complete information including all certificates, achievements, and detailed records, please check the student's full profile in the database.</p>
                                ${createdAt ? `
                                <p><strong>Submitted on:</strong> ${new Date(createdAt).toLocaleDateString()}</p>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            modal.show();
            console.log('Modal opened successfully');

        } catch (error) {
            console.error('Error opening activity modal:', error);
            alert('Error opening modal. Please check the console for details.');
        }
    }
</script>
{% endblock %}